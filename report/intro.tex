\chapter{Intro}
\label{cha:intro}
	\section{Project driver}
		\paragraph{}
		The main motivation for developing this project was the fact that it meant
		the gathering of almost every branch of this career. From its very beginning, this
		work involved both software and hardware development, researching on unknown 
		tools and platforms as well as high and low-level design and programming.
		
		\paragraph{}
		Besides, if successful, it would be likely it could become a real product
		and be useful both in a professional and particular scope, which added a practical
		end for the work to be carried out. Something like this could be made thanks to
		the special features --such as less power consumption and investment-- 802.15.4-compliant
		technology provides which dominant ones lack (Bluetooth, for instance).
		
		\paragraph{}
		In addition, not only developing applications for portable devices but accessories
		are mainstream nowadays; thus, getting in touch with these activities could
		provide us with extra experience at leading edge practices.
		
		\paragraph{}
		However, certain areas of the project would mean working on unprecedent techniques
		--as it will be detailed later on within this section-- and dealing with tools
		which were unknown for us at that moment. Hitches like these could lead to the
		unfulfillment of the project, yet they could also add extra value to it if 
		they were overcome.		
		
	\section{State of the art}
		\begin{itemize}
			\item \emph{EPFL Project}\\\\
				% Proyecto EPFL (pedir referencias a Fran)
				%\item Hace un año: estado de la comunicación android-usb y android-802.15.4 (conexión de dispositivos portátiles con sensores biométricos y no biométricos, costes, consumo, acho de banda, ...)
				% Proyecto ya existente (a nivel europeo, Lausanne, ...)
				% Aplicación ya desarrollada (dentro del mismo proyecto) para dispositivos iOS, en particular 
				% iPhone, en plan prototipo con grandes limitaciones, poco accesible (instalar manualmente 
				% stack bluetooth, implicando jailbreak), sólo por bluetooth, sin funcionalidad de lectura 
				% de logs. Dispositivos iOS alto coste.
				As a precedent of the present project, at the École Polytechnique Fédérale de Lausanne (EPFL)
				a wireless ECG monitoring system was developed, similar to the one has been built up during
				this project. Just as ours, this system also used *Shimmers as monitoring, transmitter devices; % No sé si es el nombre técnico adecuado, y tampoco sé exactamente de qué es lo que no podemos hablar.
				and the obtained data could be displayed in portable computing devices.\\\\
				Nonetheless, the list of similarities ends there. The application responsible for rendering
				the ECG waves was meant to be used over iOS devices, particularly iPhone. This fact led to several
				additional restrictions, such as mandatory usage of Bluetooth as wireless transmission method as
				well as the need of ``jailbreaking'' the device itself. Jailbreak process was needed in order that
				a explicitly installed Bluetooth stack allowed the device to receive the emitted data properly.
				Therefore, the employment of Android in our project is partially motivated by this sort of
				limitations other platforms usually impose.\\\\
				*Our project collaborates with EPFL, from whom we have received feedback as well as hardware and % No me quedó claro quién colaboraba con quién, y cómo decir que la colaboración está mediada por "Fran".
				software requirements. In fact, the aforementioned iOS application *settled most of the
				requirements for the Android one in our project, although there were added some extra ones --such as
				making logs from received data so they can be read again later--.\\
			\item \emph{IEEE 802.15.4}\\\\
				This standard describes the physical and Media Access Control (MAC) layers for low-rate wireless
				personal area networks. It is intended to be implemented into embedded devices, so as to build up
				short-range networks --10 meters, tipically-- with narrow bandwith, up to 250kbps, among other
				possibilites with lower transfer rates.\\\\
				802.15.4 is specially suitable for this kind of project due to its low power consumption. In
				fact, ZigBee, which uses this standard as its low-level layer, presents a series of advantages
				over Bluetooth, underlying technology of the previously mentioned EPFL project:
				\begin{itemize}
					\item \textbf{Lower power consumption:} 30mA, ($3\mu A$ idle); while Bluetooth uses 40mA 
						($200\mu A$ idle).
					\item \textbf{Bandwidth:} Bluetooth offers much wider bandwidth, up to 3Mbps, meanwhile ZigBee 
						only offers up to 250kbps. This, however, is not a relevant disadvantage because our needs 
						are not so high.
					\item \textbf{Host number:} ZigBee allows to build networks with up to 65535 hosts, subnetworks 
						with 255 hosts. On the ohter hand, Bluetooth can only support as much as 8 hosts within a 
						network. 
				\end{itemize}
				ZigBee, though, is not employed as a whole within this project, but 802.15.4 standard as
				its basis. Nevertheless, its advantages over Bluetooth remains the same.\\
			\item \emph{Android Accessory Development}\\\\
				As of May, 2011, there were no easy nor official methods to develop
				accessories capable of communicate with Android running devices. At that
				certain time, the release of the Android Accessory Development Kit (ADK)
				was announced in San Francisco, within the context of Google I/O, developers
				conferenced arranged by Google.\\\\
				With the release of that kit, Android project opened itself to the development
				of all kind of new accessories which would add potential and functionalities
				it lacked.\\\\
				As well as this kit, the following release of Android 3.1 API version completed
				the accessory ecosystem with the inclusion of directly supported host and device
				USB modes --previous versions of the API did only support accessory mode in a 
				provisional way--.\\
			\item \emph{ZigBee dongles}\\\\
				% Testing, testing
				In spite of the fact that there were available devices which implemented the complete ZigBee stack,
				they were only designed for being used connected to personal computers, some models with OS 
				restrictions as well.\\
		\end{itemize}
	
	\section{Main goals}
		As it was previously stated, the main objective for this project, seen as a whole system, consists of
		visually and wirelessly displaying and managing data obtained from portable, personal ECG-monitoring
		emitter devices on an Android tablet. In order that the system can operate that way, the following 
		issues would have to be resolved:
		\begin{enumerate}
			\item \emph{Communication with 802.15.4 emitters}\\\\
				An initial research was carried out so as to study precedent projects which covered communication
				using this standard with Android devices, though no results were obtained. Therefore, developing
				and	incorporating this feature to the project would make it pioneer in this field.\\\\
				However, this sort of communication is not natively supported by any existing Android device
				--not even any other widely known portable computing device--, which leads to the following goal
				for the project to fulfill.\\
			\item \emph{Android accessory development}\\\\
				As it was stated before, Android-powered devices are usually equipped with Bluetooth radio
				modules, yet they lack the capability to communicate with devices which implements other 
				standards. In order to achieve this feature for this sort of device, development of an
				specifically designed accessory is both a required and mandatory task.\\\\
				The aforementioned support Android OS provides for USB device and host modes would allow us to
				obtain data processed by the accessory through an available interface for almost every 
				Android device. In particular, USB host mode would be required so that the Android device 
				*was able to power the accessory, hence the restriction of using devices running % were?
				Android version 3.1 or newer.\\\\
				For this goal an USB-capable board equipped with an MSP430 microcontroller was chosen for acting
				as the receiver accessory. More specifically, this microcontroller would be running FreeRTOS,
				which would be accordingly modified for dealing with the USB interface and 802.15.4 
				communication.\\\\
				It is also noteworthy that the usage of a prototyping board and a potential miniaturisation of
				the previously described board were included into the scope of this objective as well.\\
			\item \emph{Android ECG application}\\\\
				Finally, an Android application acts as system's frontend. Its most relevant requirements were
				determined by the existing EPFL iOS application, with subtle modifications due to the different
				platform as well as the inclusion of an extra accessory.\\\\
				The data the application displays, in the shape of ECG waves, may be retrieved from a Bluetooth
				or 802.15.4 streaming node or a local log file. These logs are written by the application itself
				as it receives an incoming data transmission, so that it can replay them later --original
				iOS application lacked this feature--.\\\\
				Moreover, view controls shall also be offered for the user to modify display density, and move
				forwards and backwards if a log is being displayed.\\
		\end{enumerate}
		Each one of these goals are deeply detailed within their respective chapters and sections, later in this
		document.
	
	\section{Document overview}
		Over the following pages, this document will present the details about the project it refers to.
		Beginning with a deep description and analysis of the Android application's design and implementation,
		which can be found at the ``Software Development'' chapter; next, a thorough explanation about the
		employed hardware and the work it required; and, finally, an exposition of the obtained results,
		potential expansions and findings.  

		% Ideas Pool
		% ===========
		% En esta sección: Motivación y objetivos principales del proyecto
		

		% Objetivo: desarrollo de un receptor mac 802.15.4 (ZigBee) con conexión 
		% usb para dispositivos android y de una aplicación android para visualización 
		% de datos recibidos de ecg

		% Interesante porque engloba gran parte de lo aprendido en la carrera, habiendo 
		% que desarrollar el proyecto en casi todos los niveles de abstracción, desde diseño 
		% y miniaturización de placas hasta desarrollo basado en un framework de muy alto 
		% nivel como es Android, pasando por prototipado en placa(pasando por arduino) y 
		% desarrollo a nivel de microarquitecturas, en concreto FreeRTOs para procesadores MSP430.

		% Novedad en la comunicación USB entre Android y el MSP sin hardware intermedio, 
		% actuando el dispositivo Android de host para eliminar la fuente de alimentación del MSP, 
		% minimizando al máximo el coste del dispositivo de recepción
		
		% Interés en la utilización del stack ZigBee para maximizar la duración de la batería 
		% del shimmer (nodo delineador). e.g. enviando por bluetooth horas, enviando por shimmer días
		%		+ Una red zigbee es mucho más barata (y factible) que una bluetooth. Repetidores zigbee baratos.

		% Utilidad para el mundo real, que podría ser adoptada en hospitales dado que es 
		% algo que ya se ha estado probando en algunos hospitales y esto sería un importante 
		% impulso para el proyecto
		
		% Relacionado con la aplicación real en hospitales (o uso en domicilio particular) 
		% el reducido tamaño del nodo delineador permite gran portabilidad, incluso llevarlo 
		% encima con objeto de monitorización constante.
		
		% Cubre necesidad profesional, médico o enfermera monitorizando un grupo de pacientes 
		% de tamaño arbitrario con un único dispositivo android; o incluso a larga distancia 
		% recibiendo los datos por internet.
		
		% Desarrollando el uso particular, posible aplicación a particulares que posean dispositivos 
		% táctiles android, para automonitorización en enfermedades en que sea necesario.
